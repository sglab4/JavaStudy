在数据库中， 不论读一行，还是读多行，都是将这些行所在的页进行加载。也就是说存储空间的基本单位是页。一个页就是一棵树B+树的节点，**数据库I/O操作的最小单位是页**，与数据库相关的内容都会存储在页的结构里。

# 红黑树

与AVL树相比，红黑树并不追求严格的平衡，而是大致的平衡：只是确保从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。

从实现来看，红黑树最大的特点是每个节点都属于两种颜色(红色或黑色)之一，且节点颜色的划分需要满足特定的规则。

> 红黑树是满足如下条件的二叉搜索树：
>
> 1. 每个结点要么是红色，要么是黑色
> 2. 根节点是黑色
> 3. 每个叶结点（NIL结点，空结点）是黑色的
> 4. 不能有相邻的两个红色结点
> 5. 从任一结点到其每个叶子的所有路径都包含相同数目的黑色结点

![img](https://pict-picgo.oss-cn-hangzhou.aliyuncs.com/picture2/202204011114834.jpeg)

对于数据在内存中的情况（如上述的TreeMap和HashMap），红黑树的表现是非常优异的。但是对于数据在磁盘等辅助存储设备中的情况（如MySQL等数据库），红黑树并不擅长，因为红黑树长得还是太高了。当数据在磁盘中时，磁盘IO会成为最大的性能瓶颈，设计的目标应该是尽量减少IO次数；而**树的高度越高，增删改查所需要的IO次数也越多，会严重影响性能。**

# B 树

![5](https://pict-picgo.oss-cn-hangzhou.aliyuncs.com/picture2/202204011115593.png)

**图中的每个节点称为页，页就是我们上面说的磁盘块，在 MySQL 中数据读取的基本单位都是页，所以我们这里叫做页更符合 MySQL 中索引的底层数据结构。**

从上图可以看出，B 树相对于平衡二叉树，每个节点存储了**更多的键值（key）和数据（data）**，并且每个节点拥有更多的子节点，子节点的个数一般称为**阶**，上述图中的 B 树为 3 阶 B 树，高度也会很低。

基于这个特性，B 树查找数据读取磁盘的次数将会很少，数据的查找效率也会比平衡二叉树高很多。

# B+ 树

![6](https://pict-picgo.oss-cn-hangzhou.aliyuncs.com/picture2/202204011115353.png)

优点：

① B+ 树非叶子节点上是不存储数据的，仅存储键值，而 B 树节点中不仅存储键值，也会存储数据。

在**数据库中页的大小是固定的**，**InnoDB 中页的默认大小是 16KB。**

如果不存储数据，那么就会存储更多的键值，相应的树的阶数（节点的子节点树）就会更大，树就会更矮更胖，如此一来我们**查找数据进行磁盘的 IO 次数又会再次减少，数据查询的效率也会更快。**

② B+ 树索引的所有数据均存储在叶子节点，而且数据是按照顺序排列的。

**B+ 树使得范围查找，排序查找，分组查找以及去重查找变得异常简单**。而 B 树因为数据分散在各个节点，要实现这一点是很不容易的。

**B+ 树中各个页之间是通过双向链表连接的，叶子节点中的数据是通过单向链表连接的。**

## B+树与B树的不同：

1. B+树非叶子节点不存在数据只存索引，B树非叶子节点存储数据
2. **B+树查询效率更高**。B+树使用双向链表串连所有叶子节点，区间查询效率更高（因为所有数据都在B+树的叶子节点，扫描数据库 只需扫一遍叶子结点就行了），但是B树则需要通过中序遍历才能完成查询范围的查找。
3. **B+树查询效率更稳定。**B+树每次都必须查询到叶子节点才能找到数据，而B树查询的数据可能不在叶子节点，也可能在，这样就会造成查询的效率的不稳定
4. **B+树的磁盘读写代价更小**。B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小，通常B+树矮更胖，高度小查询产生的I/O更少。



